(this["webpackJsonpably-game"]=this["webpackJsonpably-game"]||[]).push([[0],{22:function(e,t,n){"use strict";n.r(t);var a=n(28),o=n(29);window.Ably=new a.Realtime("".concat(o.ABLY_API_KEY))},23:function(e,t,n){e.exports=n.p+"static/media/road_0.cdfb2ff8.png"},25:function(e,t,n){e.exports=n.p+"static/media/player_walk.9f19440f.png"},26:function(e,t,n){e.exports=n.p+"static/media/DM-CGS-45.022609e8.wav"},27:function(e,t,n){e.exports=n.p+"static/media/DM-CGS-18.52ceb82a.wav"},29:function(e,t){},33:function(e,t,n){e.exports=n(50)},38:function(e,t,n){},39:function(e,t,n){},48:function(e,t,n){},50:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(13),l=n.n(r),c=(n(38),n(23)),i=n.n(c),s=n(2),u=n(32),p=(n(39),n(9)),d=Object(p.b)((function(e){return Object(s.a)({},e.user)}))((function(e){var t=Object(a.useState)(""),n=Object(u.a)(t,2),r=n[0],l=n[1];return o.a.createElement("div",{className:"pop-wrapper"},o.a.createElement("h5",null,"Enter Your Nickname to Play ",r),o.a.createElement("input",{type:"text",placeholder:"otuka",onChange:function(e){return l(e.target.value)}}),o.a.createElement("br",null),o.a.createElement("button",{onClick:function(){r.length>0&&e.dispatch({type:"USERNAME",payload:{username:r}}),localStorage.setItem("username",r),window.location.reload(!0)},disabled:!r},"Join"))})),m=n(25),g=n.n(m),f=n(12),v={position:[0,0],spriteLocation:"0px 0px",walkingIndex:0,steps:0},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"MOVE_PLAYER":return Object(s.a)({},a);default:return e}},h={tiles:[]},E={score:JSON.parse(localStorage.getItem("score"))||0,level:JSON.parse(localStorage.getItem("level"))||0},w={isPlaying:JSON.parse(localStorage.getItem("isPlaying"))||!1},S={timer:0},b={volume:1},O={username:localStorage.getItem("username")||""},x={members:[]},N={endGame:!1},I=Object(f.b)({player:y,map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"ADD_TILES":return Object(s.a)({},a);default:return e}},control:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"UPDATE_SCORE":return Object(s.a)({},a);default:return e}},global:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"PLAY":return Object(s.a)({},a);default:return e}},timing:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"TIMER":return Object(s.a)({},a);default:return e}},sound:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"SOUND_CONTROL":return Object(s.a)({},a);default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"USERNAME":return Object(s.a)({},a);default:return e}},members:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"MEMBERS_PRESENCE":return Object(s.a)({},a);default:return e}},endGame:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"END_GAME":return Object(s.a)({},a);default:return e}}}),_=Object(f.c)((function(e,t){return I(e,t)}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),A=n(26),P=n.n(A),j=n(27),k=n.n(j),G=function(e){switch(e){case 0:return"stones";case 2:return"finish";default:return"default"}},T=function(e,t,n){switch(t){case"NORTH":return{postion:[e[0]-40,e[1]],location:"".concat(40*n,"px ").concat(120,"px")};case"SOUTH":return{postion:[e[0]+40,e[1]],location:"".concat(40*n,"px ").concat(0,"px")};case"WEST":return{postion:[e[0],e[1]-40],location:"".concat(40*n,"px ").concat(80,"px")};case"EAST":return{postion:[e[0],e[1]+40],location:"".concat(40*n,"px ").concat(40,"px")};default:return{postion:[0,0],location:"0px 0px"}}},R=n(18),D=n.n(R);n(22);var L=JSON.parse(localStorage.getItem("steps"))||0,M=Object(p.b)((function(e){return Object(s.a)({},e.player,{members:e.members,isPlaying:e.global.isPlaying,timer:e.timing.timer})}))(function(e){var t=new D.a(P.a,{throttleMs:50}),n=new D.a(k.a,{throttleMs:100});window.Ably.connection.on((function(e){console.log("New connection state is "+e.current)}));var a=window.Ably.channels.get("cloudflare:worker:"+function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=n.length,o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*a));return t}(6)),o=function(){var e=_.getState().control.level;return _.getState().map.tiles[e]},r=function(e){var r=_.getState().map.tiles,l=_.getState().control.level,c=_.getState().sound.volume,i=_.getState().timing.timer,s=_.getState().user.username,u=_.getState().control.score;if(2===function(e){var t=o(),n=e[1]/40;return t[e[0]/40][n]}(e))return r.length>l+1?(window.localStorage.setItem("level",l+1),window.localStorage.setItem("score",u),window.localStorage.setItem("isComplete",!0),t.play(c),_.dispatch({type:"UPDATE_SCORE",payload:{level:l+1,score:u+10}}),a.publish("player",{username:s,isCompleted:!0,timeSpent:i,playerSteps:L},(function(e){if(e)return console.error("Failed to publish",e);console.log("published")})),window.alert(" Level ".concat(l+1," complete successfully! ").concat(i))):(_.dispatch({type:"PLAY",payload:{isPlaying:!1}}),n.play(c),window.alert("Game Complete!"))},l=function(e,t){var n=function(){var e=_.getState().player.walkingIndex;return e>=7?0:e+1}(),a=JSON.parse(localStorage.getItem("steps"));_.dispatch({type:"MOVE_PLAYER",payload:{position:t,direction:e,walkingIndex:n,spriteLocation:T([],e,n).location,steps:a}})},c=function(e){var t=_.getState().player.position,n=_.getState().global.isPlaying,a=T(t,e,null).postion;if(n&&function(e){return e[0]>=0&&e[0]<=440&&e[1]>=0&&e[1]<=760}(a)&&function(e){var t=o(),n=e[1]/40;return 0!==t[e[0]/40][n]}(a))return localStorage.setItem("steps",L++),r(a),l(e,a)},i=function(e){_.getState().user.username&&function(e){switch(e.preventDefault(),e.keyCode){case 37:return c("WEST");case 39:return c("EAST");case 38:return c("NORTH");case 40:return c("SOUTH");default:c(e.keyCode)}}(e)};return window.addEventListener("keydown",(function(e){i(e)})),e}((function(e){return Object(a.useEffect)((function(){var e=localStorage.getItem("username");if(e){var t=window.Ably.channels.get("cloudflare-bot");t.subscribe((function(e){e.data.endGame&&(localStorage.removeItem("username"),_.dispatch({type:"PLAY",payload:{isPlaying:e.data.isPlaying}}),_.dispatch({type:"END_GAME",payload:{endGame:e.data.endGame}}),_.dispatch({type:"USERNAME",payload:{username:null}}))})),t.presence.enterClient(e)}}),[]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{position:"absolute",top:e.position[0],left:e.position[1],backgroundImage:"url('".concat(g.a,"')"),backgroundPosition:e.spriteLocation,width:"40px",height:"40px"}}))}))),C=[[[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0],[1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,2],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,2,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]],U=(n(48),function(e){return o.a.createElement("div",{className:"tile ".concat(G(e.value))})}),Y=function(e){return o.a.createElement("div",{className:"row",style:{height:40}},e.tiles.map((function(e,t){return o.a.createElement(U,{key:t,value:e})})))},J=Object(p.b)((function(e){return{level:e.control.level,tiles:e.map.tiles,score:e.control.score,isPlaying:e.global.isPlaying,timer:e.timing.timer,endGame:e.endGame.endGame}}))((function(e){return Object(a.useEffect)((function(){_.dispatch({type:"ADD_TILES",payload:{tiles:C}}),e.endGame&&localStorage.clear()}),[e.score,e.endGame]),o.a.createElement("div",{style:{position:"relative",top:"0px",left:"0px",width:800,height:480}},!e.endGame&&e.tiles[e.level]&&e.tiles[e.level].map((function(e,t){return o.a.createElement(Y,{key:t,tiles:e})})),e.endGame&&o.a.createElement("h1",{className:"end"},"Game Over! You spent too much time trying to make a delivery"))})),H=function(){var e=_.getState().user.username;return o.a.createElement("div",{className:"world",style:{position:"relative",width:800,height:480,borderRadius:"5px",margin:"20px auto",boxShadow:"1px -2px 13px 0px grey",backgroundImage:"url(".concat(i.a,")")}},e?o.a.createElement(o.a.Fragment,null,o.a.createElement(J,null),o.a.createElement(M,null)):o.a.createElement(d,null))},V=n(30),X=n(10);var B=function(){return o.a.createElement(V.a,null,o.a.createElement("div",null,o.a.createElement(X.c,null,o.a.createElement(X.a,{path:"/"},o.a.createElement(H,null)))))};n(22),l.a.render(o.a.createElement(p.a,{store:_},o.a.createElement(B,null)),document.getElementById("root"))}},[[33,1,2]]]);
//# sourceMappingURL=main.feccfbeb.chunk.js.map