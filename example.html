<html>
  <body>
    <h1>Presence example</h1>

    <h2>Live-updated presence set:</h2>
    <ul id="presence-set"></ul>
  </body>

  <!-- Include the latest Ably Library  -->
  <script src="https://cdn.ably.io/lib/ably.min-1.js"></script>

  <!-- Instance the Ably library  -->
  <script type="text/javascript">
    alert("You need to add your API key"); /* REMOVE THIS */
    var realtime = new Ably.Realtime({
      key: "INSERT-YOUR-API-KEY-HERE", /* ADD YOUR API KEY HERE */
      clientId: "my-client-id", /* This is who you will appear as in the presence set */
      closeOnUnload: true // See https://support.ably.io/solution/articles/3000059875-why-don-t-presence-members-leave-as-soon-as-i-close-a-tab-
    });

    /* Enter the presence set of the 'chatroom' channel */
    var channel = realtime.channels.get('chatroom');
    channel.attach(function(err) {
      if(err) { return console.error("Error attaching to the channel"); }
      console.log('We are now attached to the channel');
      channel.presence.enter('hello', function(err) {
        if(err) { return console.error("Error entering presence"); }
        console.log('We are now successfully present');
      });

      /* Every time the presence set changes, show the new set */
      channel.presence.subscribe(function(presenceMsg) {
        console.log('Received a ' + presenceMsg.action + ' from ' + presenceMsg.clientId);
        channel.presence.get(function(err, members) {
          if(err) { return console.log("Error fetching presence data: " + err); }
          document.getElementById('presence-set').innerHTML = members.map(function(member) {
            return '<li>' + member.clientId + '</li>';
          }).join();
        });
      });
    });
  </script>
</html>
